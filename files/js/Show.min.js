var Show={};Show.Category={};Show.Entry={};Show.Entry.Coordinates={};Show.Map={};Show.Category.MarkAllAsRead=Class.extend({_callback:null,_proxy:null,init:function(a){this._callback=a;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".markAllAsReadButton").click($.proxy(this._click,this))},_click:function(a){a.preventDefault();this._proxy.setOption("data",{actionName:"markAllAsRead",className:"show\\data\\category\\ShowCategoryAction"});this._proxy.sendRequest()},_success:function(d,e,c){if(this._callback&&$.isFunction(this._callback)){return this._callback()}var a=$(".nestedCategoryList");a.find(".badge.badgeUpdate").hide();$(".mainMenu .active .badge").hide();var b=new WCF.System.Notification(WCF.Language.get("wcf.global.success"),"success");b.show()}});Show.Entry.Clipboard=Class.extend({_categoryID:0,_environment:"category",_updateHandler:null,init:function(b,a,c){this._updateHandler=b;this._environment=a;this._categoryID=(c)?c:0;require(["EventHandler"],function(d){d.add("com.woltlab.wcf.clipboard","com.uz.show.entry",this._clipboardAction.bind(this))}.bind(this))},_clipboardAction:function(b){if(b.data.actionName==="com.uz.show.entry.assignLabel"){Show.Entry.AssignLabelHandler.prepare(b.data.parameters)}else{if(b.responseData&&b.responseData.returnValues&&b.responseData.returnValues.entryData){var c=b.responseData.returnValues.entryData;for(var a in c){if(c.hasOwnProperty(a)){this._updateHandler.update(a,c[a])}}}}}});Show.Entry.InlineEditor=WCF.InlineEditor.extend({_environment:"entry",_permissions:{},_redirectURL:"",_updateHandler:null,_setOptions:function(){this._environment="entry";this._options=[{label:WCF.Language.get("show.entry.edit.enable"),optionName:"enable"},{label:WCF.Language.get("show.entry.edit.disable"),optionName:"disable"},{label:WCF.Language.get("show.entry.edit.trash"),optionName:"trash"},{label:WCF.Language.get("show.entry.edit.restore"),optionName:"restore"},{label:WCF.Language.get("show.entry.edit.delete"),optionName:"delete"},{optionName:"divider"},{label:WCF.Language.get("show.entry.edit.setAsFeatured"),optionName:"setAsFeatured"},{label:WCF.Language.get("show.entry.edit.unsetAsFeatured"),optionName:"unsetAsFeatured"},{optionName:"divider"},{label:WCF.Language.get("wcf.global.button.edit"),optionName:"edit",isQuickOption:true}]},setUpdateHandler:function(a){this._updateHandler=a},_getTriggerElement:function(a){return a.find(".jsEntryInlineEditor")},_show:function(b){var c=$(b.currentTarget).data("elementID");var a=null;if(!this._dropdowns[c]){a=this._getTriggerElement(this._elements[c]).addClass("dropdownToggle");a.parent().addClass("dropdown");this._dropdowns[c]=$('<ul class="dropdownMenu" />').insertAfter(a)}this._super(b);if(a!==null){WCF.Dropdown.initDropdown(a,true)}return false},_validate:function(b,c){var a=$("#"+b).data("entryID");switch(c){case"delete":if(!this._getPermission("canDeleteEntryCompletely")){return false}return(this._updateHandler.getValue(a,"isDeleted"));break;case"restore":if(!this._getPermission("canRestoreEntry")){return false}return(this._updateHandler.getValue(a,"isDeleted"));break;case"trash":if(!this._getPermission("canDeleteEntry")){return false}return !(this._updateHandler.getValue(a,"isDeleted"));break;case"enable":if(!this._getPermission("canEnableEntry")){return false}if(this._updateHandler.getValue(a,"isDeleted")){return false}return(this._updateHandler.getValue(a,"isDisabled"));break;case"disable":if(!this._getPermission("canEnableEntry")){return false}if(this._updateHandler.getValue(a,"isDeleted")){return false}return !(this._updateHandler.getValue(a,"isDisabled"));break;case"setAsFeatured":if(!this._getPermission("canSetAsFeatured")){return false}return !(this._updateHandler.getValue(a,"isFeatured"));break;case"unsetAsFeatured":if(!this._getPermission("canSetAsFeatured")){return false}return(this._updateHandler.getValue(a,"isFeatured"));break;case"edit":return true;break}return false},_execute:function(a,c){if(!this._validate(a,c)){return false}switch(c){case"enable":case"disable":this._updateEntry(a,c,{isDisabled:(c==="enable"?0:1)});break;case"delete":var b=this;WCF.System.Confirmation.show(WCF.Language.get("show.entry.confirmDelete"),function(d){if(d==="confirm"){b._updateEntry(a,c,{deleted:1})}});break;case"restore":this._updateEntry(a,c,{isDeleted:0});break;case"trash":var b=this;WCF.System.Confirmation.show(WCF.Language.get("show.entry.confirmTrash"),function(d){if(d==="confirm"){b._updateEntry(a,c,{isDeleted:1,reason:$("#wcfSystemConfirmationContent").find("textarea").val()})}},{},$('<div class="section"><dl><dt><label for="entryDeleteReason">'+WCF.Language.get("show.entry.confirmTrash.reason")+'</label></dt><dd><textarea id="entryDeleteReason" cols="40" rows="4" /></dd></dl></div>'));break;case"setAsFeatured":case"unsetAsFeatured":this._updateEntry(a,c,{isFeatured:(c==="setAsFeatured"?1:0)});break;case"edit":window.location=this._getTriggerElement($("#"+a)).prop("href");break;default:return false;break}return true},_updateEntry:function(b,d,e){if(d==="delete"){var c=this;var a=this._elements[b].data("entryID");new WCF.Action.Proxy({autoSend:true,data:{actionName:d,className:"show\\data\\entry\\EntryAction",objectIDs:[a]},success:function(f){c._updateHandler.update(a,f.returnValues.entryData[a])}})}else{this._updateData.push({data:e,elementID:b,optionName:d});this._proxy.setOption("data",{actionName:d,className:"show\\data\\entry\\EntryAction",objectIDs:[this._elements[b].data("entryID")],parameters:{data:e}});this._proxy.sendRequest()}},_updateState:function(b){if(this._environment=="entry"&&this._updateData.length==1&&this._updateData[0].optionName=="trash"&&!this._getPermission("canViewDeletedEntry")){this._notification.show($.proxy(function(){window.location=this._redirectURL},this));return}this._notification.show();for(var f=0,e=this._updateData.length;f<e;f++){var d=this._updateData[f];var c=$("#"+d.elementID).data("entryID");var a=d.data;if(d.optionName==="trash"&&b&&b.returnValues&&b.returnValues.entryData&&b.returnValues.entryData[c]){a.deleteNote=b.returnValues.entryData[c].deleteNote}this._updateHandler.update(c,a)}},_getPermission:function(a){if(this._permissions[a]){return this._permissions[a]}return 0},setEnvironment:function(a,b){if(a!=="category"){a="entry"}this._environment=a;this._redirectURL=b},setPermission:function(a,b){this._permissions[a]=b},setPermissions:function(a){for(var b in a){this.setPermission(b,a[b])}}});Show.Entry.UpdateHandler=Class.extend({_entrys:{},init:function(){var a=this;$(".showEntry").each(function(c,d){var b=$(d);a._entrys[b.data("objectID")]=b})},update:function(a,c){if(!this._entrys[a]){console.debug("[Show.Entry.UpdateHandler] Unknown entry id "+a);return}for(var b in c){this._updateProperty(a,b,c[b])}},_updateProperty:function(a,c,b){switch(c){case"deleted":this._delete(a,b);break;case"deleteNote":this._deleteNote(a,b);break;case"isDeleted":if(b){this._trash(a)}else{this._restore(a)}break;case"isDisabled":if(b){this._disable(a)}else{this._enable(a)}break;case"isFeatured":if(b){this._setAsFeatured(a)}else{this._unsetAsFeatured(a)}break;default:this._handleCustomProperty(a,c,b);break}},_handleCustomProperty:function(a,c,b){this._entrys[a].trigger("entryUpdateHandlerProperty",[a,c,b])},_delete:function(a,b){},_deleteNote:function(a,b){},_disable:function(a){this._entrys[a].data("isDisabled",1)},_enable:function(a){this._entrys[a].data("isDisabled",0)},_restore:function(a){this._entrys[a].data("isDeleted",0)},_setAsFeatured:function(a){this._entrys[a].data("isFeatured",1)},_trash:function(a){this._entrys[a].data("isDeleted",1)},_unsetAsFeatured:function(a){this._entrys[a].data("isFeatured",0)},getValue:function(a,b){if(!this._entrys[a]){console.debug("[Show.Entry.UpdateHandler] Unknown entry id "+a);return}switch(b){case"isDeleted":return this._entrys[a].data("isDeleted");break;case"isDisabled":return this._entrys[a].data("isDisabled");break;case"isFeatured":return this._entrys[a].data("isFeatured");break}}});Show.Entry.UpdateHandler.Category=Show.Entry.UpdateHandler.extend({_delete:function(a,b){this._entrys[a].remove();delete this._entrys[a];WCF.Clipboard.reload()},_deleteNote:function(a,b){},_disable:function(a){this._super(a);this._entrys[a].addClass("messageDisabled")},_enable:function(a){this._super(a);this._entrys[a].removeClass("messageDisabled")},_restore:function(b){this._super(b);this._entrys[b].removeClass("messageDeleted");this._entrys[b].find(".showEntryDeleteNote").remove();var c=elByClass("entry"+b);var a=c[0].getAttribute("data-is-disabled");if(a=="1"){this._entrys[b].addClass("messageDisabled")}},_setAsFeatured:function(a){this._super(a);$('<span class="badge label green jsLabelFeatured">'+WCF.Language.get("show.entry.featured")+"</span>").appendTo(this._entrys[a].find(".showEntryIconContainer"))},_trash:function(a){this._super(a);this._entrys[a].removeClass("messageDisabled");this._entrys[a].addClass("messageDeleted")},_unsetAsFeatured:function(a){this._super(a);this._entrys[a].find(".jsLabelFeatured").remove()}});Show.Entry.UpdateHandler.Entry=Show.Entry.UpdateHandler.extend({update:function(a,b){if(this._entrys[a]){if(b.isDeleted!==undefined&&!b.isDeleted){this._restore(a,true);delete b.isDeleted}if(b.isDisabled!==undefined&&!b.isDisabled){this._enable(a,true);delete b.isDisabled}}this._super(a,b)},_delete:function(a,b){new WCF.PeriodicalExecuter(function(c){c.stop();window.location=b},1000)},_deleteNote:function(a,b){$('<div class="section"><p class="showEntryDeleteNote">'+b+"</p></div>").insertBefore($("#overview .showEntryLikesSummery"))},_disable:function(a){this._super(a);this._entrys[a].addClass("messageDisabled")},_enable:function(a){this._super(a);this._entrys[a].removeClass("messageDisabled")},_restore:function(b){this._super(b);this._entrys[b].removeClass("messageDeleted");$("#overview .showEntryDeleteNote").remove();var c=elByClass("entry"+b);var a=c[0].getAttribute("data-is-disabled");if(a=="true"){this._entrys[b].addClass("messageDisabled")}},_setAsFeatured:function(a){this._super(a);$('<span class="badge label green jsLabelFeatured">'+WCF.Language.get("show.entry.featured")+"</span>").prependTo($(".showEntry .contentTitle"))},_trash:function(a){this._super(a);this._entrys[a].addClass("messageDeleted")},_unsetAsFeatured:function(a){this._super(a);$(".jsLabelFeatured").remove()}});Show.Entry.Preview=WCF.Popover.extend({_proxy:null,init:function(){this._super(".showEntryLink");this._proxy=new WCF.Action.Proxy({showLoadingOverlay:false});WCF.DOMNodeInsertedHandler.addCallback("Show.Entry.Preview",$.proxy(this._initContainers,this))},_loadContent:function(){var b=$("#"+this._activeElementID);this._proxy.setOption("data",{actionName:"getEntryPreview",className:"show\\data\\entry\\EntryAction",objectIDs:[b.data("entryID")]});var c=this._activeElementID;var a=this;this._proxy.setOption("success",function(e,f,d){a._insertContent(c,e.returnValues.template,true)});this._proxy.sendRequest()}});Show.Entry.WatchedEntryList=Class.extend({_button:null,_markAllCheckbox:null,init:function(){this._button=$("#stopWatchingButton").click($.proxy(this._stopWatching,this));this._markAllCheckbox=$(".jsMarkAllWatchedEntrys").change($.proxy(this._markAll,this));$(".jsWatchedEntry").change($.proxy(this._mark,this))},_mark:function(a){$(a.target).parents("tr").toggleClass("jsMarked");if(this._markAllCheckbox.is(":checked")){this._markAllCheckbox.prop("checked",false)}else{this._markAllCheckbox.prop("checked",$(".jsWatchedEntry:not(:checked)").length==0)}this._updateButtonLabel()},_markAll:function(a){$(".jsWatchedEntry").prop("checked",this._markAllCheckbox.prop("checked")).parents("tr").toggleClass("jsMarked",this._markAllCheckbox.prop("checked"));this._updateButtonLabel()},_stopWatching:function(b){var a=$(".jsWatchedEntry:checked");var d=[];var c=false;if(a.length){a.each(function(f,g){d.push($(g).data("objectID"))})}else{c=true}var e="show.entry.watchedEntrys.stopWatchingMarked.confirmMessage";if(c){e="show.entry.watchedEntrys.stopWatchingAll.confirmMessage"}WCF.System.Confirmation.show(WCF.Language.get(e),function(f){if(f==="confirm"){new WCF.Action.Proxy({autoSend:true,data:{actionName:"stopWatching",className:"show\\data\\entry\\EntryAction",parameters:{stopWatchingAll:c,entryIDs:d}},success:function(){window.location.reload()}})}})},_updateButtonLabel:function(){var b=$(".jsWatchedEntry:checked");var a="";if(b.length){a=WCF.Language.get("show.entry.watchedEntrys.stopWatchingMarked",{count:b.length})}else{a=WCF.Language.get("show.entry.watchedEntrys.stopWatchingAll")}this._button.html(a)}});Show.Entry.IconUpload=WCF.Upload.extend({_deleteEntryIconButton:null,_entryID:0,_icon:null,_tmpHash:"",init:function(a,b){this._entryID=a;this._tmpHash=b;this._icon=$("#entryIcon");this._deleteEntryIconButton=$("#deleteEntryIcon").click($.proxy(this._confirmDeleteIcon,this));this._super($("#entryIconUploadButton"),$("<ul />"),"show\\data\\entry\\EntryAction",{action:"uploadIcon"})},_getParameters:function(){return{entryID:this._entryID,tmpHash:this._tmpHash}},_success:function(c,a){if(a.returnValues.url){this._getIcon().show().attr("src",a.returnValues.url+"?timestamp="+Date.now());this._buttonSelector.next(".innerError").remove();var b=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));b.show();this._deleteEntryIconButton.show()}else{if(a.returnValues.errorType){this._getInnerErrorElement().text(WCF.Language.get("show.entry.icon.error."+a.returnValues.errorType))}}},_upload:function(){this._super();if(this._fileUpload){this._removeButton();this._createButton()}},_getIcon:function(){if(!this._icon.length){this._icon=$('<img src="" alt="" id="entryIcon" />').prependTo($("#entryIconUpload > dd"))}return this._icon},_getInnerErrorElement:function(){var a=$("#entryIconUploadButton").next(".innerError");if(!a.length){a=$('<small class="innerError" />').insertAfter($("#entryIconUploadButton"))}return a},_confirmDeleteIcon:function(a){a.preventDefault();WCF.System.Confirmation.show(WCF.Language.get("show.entry.icon.delete.confirmMessage"),$.proxy(function(b){if(b==="confirm"){this._deleteIcon()}},this))},_deleteIcon:function(){new WCF.Action.Proxy({autoSend:true,data:{actionName:"deleteIcon",className:"show\\data\\entry\\EntryAction",parameters:this._getParameters()}});this._deleteEntryIconButton.hide();this._icon.hide()},});Show.Entry.LabelChooser=WCF.Label.Chooser.extend({_labelGroupsToCategories:null,init:function(d,c,a,b,e){this._super(c,a,b,e);this._labelGroupsToCategories=d;this._updateLabelGroups();$("#categoryID").change($.proxy(this._updateLabelGroups,this))},_updateLabelGroups:function(){$(".labelChooser").each(function(e,f){$(f).parents("dl:eq(0)").hide()});var d=[];var c=parseInt($("#categoryID").val());if(this._labelGroupsToCategories[c]){for(var a=0,b=this._labelGroupsToCategories[c].length;a<b;a++){$("#labelGroup"+this._labelGroupsToCategories[c][a]).parents("dl:eq(0)").show()}}},_submit:function(){var c=elById("tab1");if(c.classList.contains("hidden")){var d=null;for(var b=2;b<6;b++){d=elById("tab"+b);if(d&&d.classList.contains("active")){d.classList.remove("active");d.classList.add("hidden");break}}c.classList.add("active");c.classList.remove("hidden")}for(var a in this._groups){if(!this._groups[a].is(":visible")){delete this._groups[a]}}this._super()}});Show.Entry.AssignLabelHandler={_categoryID:0,_dialog:null,_objectIDs:[],prepare:function(a){this._categoryID=a.categoryID;this._objectIDs=a.objectIDs;if(this._dialog===null){this._dialog=$("<div />").appendTo(document.body);this._dialog.html(a.template);this._dialog.wcfDialog({title:WCF.Language.get("show.entry.edit.assignLabel")})}else{this._dialog.html(a.template);this._dialog.wcfDialog("open")}this._dialog.find(".formSubmit > .buttonPrimary").click($.proxy(this._click,this))},_click:function(){var a={};this._dialog.find(".labelList > .dropdown").each(function(b,d){var c=$(d);if(c.data("labelID")){a[c.data("groupID")]=c.data("labelID")}});new WCF.Action.Proxy({autoSend:true,data:{actionName:"assignLabel",className:"show\\data\\entry\\EntryAction",objectIDs:this._objectIDs,parameters:{categoryID:this._categoryID,labelIDs:a}},success:$.proxy(this._success,this)})},_success:function(c,b,f){var a=c.returnValues.labels;for(var j=0;j<c.objectIDs.length;j++){var i=$("#entry"+c.objectIDs[j]+" > td.columnSubject");var g=i.children(".labelList");if(g.length){if(a.length){g.empty()}else{g.remove()}}else{if(a.length){g=$('<ul class="labelList" />').prependTo(i)}}for(var h=0;h<a.length;h++){var e=a[h];var d=$('<li><a href="'+e.link+'" class="badge label '+e.cssClassName+'">'+WCF.String.escapeHTML(e.label)+"</a></li>").appendTo(g);d.before(" ")}}this._dialog.wcfDialog("close");WCF.Clipboard.reload();new WCF.System.Notification().show()}};Show.Entry.Coordinates.Handler=Class.extend({_form:null,_locationInput:null,init:function(a){this._locationInput=a;this._form=$("#messageContainer").submit($.proxy(this._submit,this))},_submit:function(a){if(this._form.data("geocodingCompleted")){return true}var b=$.trim($("#geocode").val());if(!b){WCF.Location.GoogleMaps.Util.reverseGeocoding($.proxy(this._reverseGeocoding,this),this._locationInput.getMarker());a.preventDefault();return false}this._setCoordinates()},_reverseGeocoding:function(a){$("#geocode").val(a);this._setCoordinates();this._form.trigger("submit")},_setCoordinates:function(){var a=this._form.find(".formSubmit");$('<input type="hidden" name="latitude" value="'+this._locationInput.getMarker().getPosition().lat()+'" />').appendTo(a);$('<input type="hidden" name="longitude" value="'+this._locationInput.getMarker().getPosition().lng()+'" />').appendTo(a);this._form.data("geocodingCompleted",true)}});Show.Map.LargeMap=WCF.Location.GoogleMaps.LargeMap.extend({init:function(e,b,d,c,a){if(!b){b={}}b.stringifyExcludedObjectIds=true;this._super(e,b,d,c,a)},_success:function(c,f,b){if(c.returnValues&&c.returnValues.markers){for(var e=0,d=c.returnValues.markers.length;e<d;e++){var a=c.returnValues.markers[e];this.addMarker(a.latitude,a.longitude,a.title,null,a.infoWindow,a.dialog,a.location);if(a.objectID){this._objectIDs.push(a.objectID)}else{if(a.objectIDs){this._objectIDs=this._objectIDs.concat(a.objectIDs)}}}}},addMarker:function(b,a,d,c,e,h,f){var g=$(e).get(0);var i=this._super(b,a,d,c,g);return i.infoWindow}});
